<section id="filterable-content"></section>

<script type="text/babel">

// Component to render the clear filters field
// To DO: clear fields on click, maybe refresh page. 

var ClearFilter = React.createClass({
	render: function(){
		return(
			<div>
				<div className="clear-filter">
					<a href="#" id="clear-filter">Clear filters</a>
				</div>
			</div>
		)
	}
});

var CheckBoxes = React.createClass({

	handleChange: function(){
		console.log('one or both of the checkboxes have been ticked');
		// To Do: add the filter/change events. Waaaay ahead of that though. 
	},

	render: function(){
		return(
			<div>
				<div className="mvis">
					<input type="checkbox" onChange={this.handleChange}/>
					<label>Movies</label>
				</div>
				<div className="books">
					<input type="checkbox" onChange={this.handleChange}/>
					<label>Books</label>
				</div>
			</div>
		)
	}
}); 

// Component to render the search box field
// ToDO: MOst of it. 

var SearchBox = React.createClass({
	render: function() {
    return (
  	<div>
		<input type="text" className="search" placeholder="Search" />
	</div>
    );
  }
});


// Render the component for the Year dropdown list
// TO DO: Dynamically populate the options list and output


var YearList = React.createClass({
	render: function(){
		return(
		<div className="fl-lt">
			<select id="Year">
				<option value="" default>YEARS</option>
				<option value="2016">2016</option>
				<option value="2012">2012</option>
				<option value="1989">1989</option>
				<option value="1973">1973</option>
				<option value="1945">1945</option>
			</select>
			<div></div>
		</div>
		)
	}
});


// Render the component for the Genre dropdown list
// TO DO: Dynamically populate the options list and output

var GenreList = React.createClass({
	
	render: function(){
		return(
			<div className="fl-lt">
				<select id="Genre">
				</select>
				<div></div>
			</div>
		)
	}
});


// Dropdown Filters (pass in components we're rendering for the GenreList, YearList and SearchBox. Also ClearFilter, but may break that out. We'll see. It's late and I can barely see straight. )

var DropDownFilters = React.createClass({

	render: function(){
		return (
			<div>
				<GenreList />
				<YearList />
				<SearchBox />
				<CheckBoxes />
				<ClearFilter />

			</div>
		);
	}
});

// Right, on to the actual element. So we're going to render the movies into the ul and then once there's some output we'll hook it up. 

var MovieItem = React.createClass({

	linkOnClick: function(){
		// ToDo: stop it returning undefined. 
		console.log('Test'); 
	}, 
	render: function(){
	
		return(
			<li>
	            
	            <div>
	            	<img src={this.props.poster} />
					<p>{this.props.title}</p>
					<p>Genre: {this.props.genre}</p>
					<a onClick={this.linkOnClick}>Click</a>
				</div>
				
			</li>
		)
	}
}); 

var MovieOutput = React.createClass({
	render: function(){
		return(
		<div>
			<div id="movies">
				<div>
					<ul id="list">
						<MovieItem title="The Revenant" genre="Horror, Comedy, Satirical" type="movie" poster="http://fillmurray.com/100/100"/>
					</ul>
				</div>
			</div> 
		</div>
		)
	}
});

// Render the MovieList Component to the filterable-content section
// load in JSON data from file (set URL on the output component so I can use it again as this.props/url)
// probably betrer to pass values for lists and stuff as props. Bit more reading. 

var MovieList = React.createClass({

	loadMoviesFromJson: function() {
	    $.ajax({
	      url: this.props.url,
	      dataType: 'json',
	      cache: false,
	      success: function(data) {

	        this.setState({data: data.media});
	      	console.log(data.media);	        
	        var i = '';
	        for(i = 0; i <= data.media.length; i++){
	        	var objtitle = this.state.data[i].title;
	        	console.log(objtitle);
			}
	        // grand - is logging the object, seems to be correct. Fire ahead so... 
	      }.bind(this),
	      error: function(xhr, status, err) {
	        console.error(this.props.url, status, err.toString());
	      }.bind(this)
	    });
	},	

	getInitialState: function() {
	    // pass in an empty array so that this returns true/doesn't throw an error. 
	    //console.log(data);
	    console.log("initial state");
	    return {data: []}; 
	   	
	},

    componentDidMount: function(){
	  	// fire up the function to load in the json. 
		this.loadMoviesFromJson();
  	}, 
   
	render: function() {    
		//console.log(data.media[2].title);	
		return (
	  	
	      <div>
	      		<div>
	      			<div className="filter">
	        			<DropDownFilters />
	        		</div>
	        		<p>{this.state.data.length} - {this.state.data.title}</p>
	        		<MovieOutput/>
	        		
	     		</div>
	     </div>
	    );
	  }
	});

// Render the actual component
ReactDOM.render(
    <MovieList url='../src/js/data/data.json' data="{data}"/>,
    document.getElementById('filterable-content')
 );

</script>